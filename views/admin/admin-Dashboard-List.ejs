<%- include('../partials/head') %>
</head>

<body
  class="bg-gray-100 min-h-screen"
  data-user-id="<%= user._id %>"
  data-user-name="<%= user.firstName %> <%= user.lastName %>"
>

<%- include('../partials/nav') %>

<div class="bg-blue-600 text-white p-6 shadow-md mb-6">
  <div class="max-w-4xl mx-auto flex justify-between items-center">
    <h1 class="text-2xl font-bold">Welcome, <%= user.firstName %> ðŸ‘‹</h1>
    <div class="bg-blue-500 px-4 py-2 rounded-lg text-sm">
      Your ID: <span class="font-mono font-bold"><%= user._id %></span>
    </div>
  </div>
</div>

<div class="max-w-4xl mx-auto px-5 mb-6">
  <div class="bg-white border-l-4 border-blue-500 p-4 rounded shadow-sm">
    <h3 class="text-blue-800 font-bold mb-1">How to share your screen?</h3>
    <p class="text-gray-600 text-sm">
      1. Accept the request from another user. <br>
      2. <a href="/agent/agent.exe" class="text-blue-600 underline font-bold" download>Download Agent.exe</a> <br>
      3. Rename it to <span class="bg-gray-200 px-1 font-mono text-red-600">agent_<%= user._id %>.exe</span> and run it.
    </p>
  </div>
</div>

<span id="current-user-id" 
      data-user-id="<%= user._id %>" 
      data-user-name="<%= user.firstName %> <%= user.lastName %>"
      class="hidden"></span>

<div class="p-5 max-w-4xl mx-auto">
  <div
    id="incoming-request-container"
    class="hidden bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-5 shadow-lg animate-pulse">
  </div>
</div>

<div class="fixed top-0 right-0 w-80 h-full bg-[#1E1E2E] text-white shadow-2xl z-50 p-5">
  <h2 class="text-xl font-bold flex items-center gap-2 mb-6 border-b border-gray-700 pb-4">
    <span class="h-3 w-3 bg-green-400 rounded-full animate-ping"></span>
    Live Users
  </h2>

  <div id="active-users-list" class="space-y-3 overflow-y-auto h-[calc(100%-100px)]">
    <% if (users.length > 0) { %>
      <% users.forEach(u => { %>
        <div class="bg-[#2A2A3A] p-4 rounded-xl flex flex-col gap-3 border border-gray-700">
          <div class="flex items-center gap-3">
            <div class="h-8 w-8 bg-blue-500 rounded-full flex items-center justify-center text-xs font-bold">
              <%= u.firstName[0] %><%= u.lastName[0] %>
            </div>
            <span class="font-medium text-sm"><%= u.firstName %> <%= u.lastName %></span>
          </div>

          <button
            class="request-btn w-full bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-xs font-semibold transition-all"
            data-target-id="<%= u._id %>">
            Request Access
          </button>
        </div>
      <% }) %>
    <% } else { %>
      <div id="no-users-msg" class="text-gray-400 bg-[#2A2A3A] p-5 rounded-lg text-center text-sm border border-dashed border-gray-600">
        Waiting for others to join...
      </div>
    <% } %>
  </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script src="/js/socket.js"></script>
<script src="/js/dashboard.js"></script>

</body>
</html>